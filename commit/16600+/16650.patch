From bb9f0e85b7638788cbaeb60fcbeb081db14b95d7 Mon Sep 17 00:00:00 2001
From: GitHub Action <action@github.com>
Date: Wed, 7 Jan 2026 12:26:25 +0000
Subject: [PATCH] feat: Squash PR #16650 changes

---
 python/sglang/srt/managers/data_parallel_controller.py | 2 ++
 python/sglang/srt/managers/multi_tokenizer_mixin.py    | 2 ++
 2 files changed, 4 insertions(+)

diff --git a/python/sglang/srt/managers/data_parallel_controller.py b/python/sglang/srt/managers/data_parallel_controller.py
index 4f297a32d..b09ca24c3 100644
--- a/python/sglang/srt/managers/data_parallel_controller.py
+++ b/python/sglang/srt/managers/data_parallel_controller.py
@@ -99,6 +99,8 @@ class DPBudget:
         """Update the budget queue."""
         # Update budget queue together for load updating from the same round.
         for load in load_update.loads:
+            if load is None:
+                continue
             if abs(load.ts_tic - self.ts_tic) > self.tic_window:
                 logger.debug(f"Proceed to next round: {self.ts_tic=} {load.ts_tic=}")
                 self.pending_loads.clear()
diff --git a/python/sglang/srt/managers/multi_tokenizer_mixin.py b/python/sglang/srt/managers/multi_tokenizer_mixin.py
index 0e9d314e3..d753ccf64 100644
--- a/python/sglang/srt/managers/multi_tokenizer_mixin.py
+++ b/python/sglang/srt/managers/multi_tokenizer_mixin.py
@@ -201,6 +201,7 @@ def _handle_output_by_index(output, i):
             token_steps=_extract_field_by_index(
                 output, "token_steps", i, check_length=False
             ),
+            load=output.load if i == 0 else None,
         )
     elif isinstance(output, BatchEmbeddingOutput):
         new_output = BatchEmbeddingOutput(
@@ -290,6 +291,7 @@ def _handle_output_by_index(output, i):
             token_steps=_extract_field_by_index(
                 output, "token_steps", i, check_length=False
             ),
+            load=output.load if i == 0 else None,
         )
     elif isinstance(output, BatchMultimodalOutput):
         new_output = BatchMultimodalOutput(
-- 
2.52.0

